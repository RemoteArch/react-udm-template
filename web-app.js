const{useState:useState,useEffect:useEffect}=React;class ErrorBoundary extends React.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorPageFailed:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}handleRetry=()=>{this.setState({hasError:!1,error:null,errorPageFailed:!1})};handleErrorPageFailed=()=>{this.setState({errorPageFailed:!0})};render(){if(this.state.hasError){const{errorUrl:e}=this.props;return e&&!this.state.errorPageFailed?React.createElement(ErrorPageLoader,{errorUrl:e,onErrorPageFailed:this.handleErrorPageFailed}):React.createElement(ErrorComponent,{handleRetry:this.handleRetry,error:this.state.error})}return this.props.children}}const ErrorPageLoader=({errorUrl:e,onErrorPageFailed:r})=>{const[t,o]=useState(null);return useEffect((()=>{let t=!0;return loadModule(e).then((e=>{t&&e?.default?o((()=>e.default)):t&&r()})).catch((()=>{t&&r()})),()=>{t=!1}}),[e]),t?React.createElement(t,null):null},loadModule=async e=>{const r=e.includes("?")?"&":"?",t=`${e}${r}_ts=${Date.now()}`,o=await fetch(t),s=await o.text();let l=s;if(/\.jsx$/i.test(e)){window.Babel||await new Promise(((e,r)=>{const t=document.createElement("script");t.src="assets/js/babel.min.js",t.onload=e,t.onerror=()=>r(new Error("Failed to load Babel")),document.head.appendChild(t)}));l=Babel.transform(s,{presets:["react"],sourceType:"module"}).code}const n=new Blob([l],{type:"text/javascript"}),a=URL.createObjectURL(n);try{return await import(a)}finally{URL.revokeObjectURL(a)}};window.loadModule=loadModule;const ErrorComponent=({handleRetry:e,error:r})=>React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",textAlign:"center"}},React.createElement("p",{style:{color:"#ef4444",marginBottom:"1rem"}},"Une erreur s'est produite lors du chargement."),React.createElement("button",{onClick:e,style:{padding:"0.5rem 1rem",backgroundColor:"var(--color-primary)",color:"white",borderRadius:"0.25rem",border:"none",cursor:"pointer"}},"Réessayer")),RenderComponent=({url:e,props:r={},errorUrl:t,children:o})=>{if(!e)return null;const s=React.useMemo((()=>React.lazy((async()=>{const r=await loadModule(e),t=r?.default;if(!t)throw new Error("Aucun export par défaut après chargement");return{default:t}}))),[e]);return React.createElement(ErrorBoundary,{errorUrl:t},React.createElement(React.Suspense,{fallback:React.createElement("div",null,o)},React.createElement(s,r)))};function App({url:e,props:r={},errorUrl:t,children:o}){return React.createElement(RenderComponent,{key:e,url:e,props:r,errorUrl:t},o)}class WebAppElement extends HTMLElement{constructor(){super(),this._url=null,this._errorUrl=null,this._props={},this._children=null,this._root=null}connectedCallback(){this._children=this.innerHTML,this._root=ReactDOM.createRoot(this),this._collectProps();const e=this.getAttribute("url");this._errorUrl=this.getAttribute("error"),e&&(this._url=e,this._render())}disconnectedCallback(){this._root&&this._root.unmount()}attributeChangedCallback(e,r,t){r!==t&&("url"===e?this._url=t:"error"===e?this._errorUrl=t:this._props[e]=t,this._render())}_collectProps(){this._props={};for(const e of this.attributes)"url"!==e.name&&"error"!==e.name&&(this._props[e.name]=e.value)}setErrorUrl(e){this._errorUrl=e,this.setAttribute("error",e),this._render()}getErrorUrl(){return this._errorUrl}setUrl(e){this._url=e,this.setAttribute("url",e),this._render()}getUrl(){return this._url}setProps(e){this._props={...this._props,...e},this._render()}getProps(){return this._props}_render(){this._root&&this._url&&this._root.render(React.createElement(App,{url:this._url,props:this._props,errorUrl:this._errorUrl},React.createElement("div",{dangerouslySetInnerHTML:{__html:this._children}})))}}customElements.define("web-app",WebAppElement);