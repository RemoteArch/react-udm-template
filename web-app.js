const e=e=>new Promise(((t,r)=>{const o=document.createElement("script");o.src=e,o.onload=t,o.onerror=()=>r(new Error(`Failed to load ${e}`)),document.head.appendChild(o)}));window.loadScript=e,"undefined"==typeof React&&await e("https://unpkg.com/react@18/umd/react.production.min.js"),"undefined"==typeof ReactDOM&&await e("https://unpkg.com/react-dom@18/umd/react-dom.production.min.js");const{useState:t,useEffect:r}=React;class o extends React.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorPageFailed:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}handleRetry=()=>{this.setState({hasError:!1,error:null,errorPageFailed:!1})};handleErrorPageFailed=()=>{this.setState({errorPageFailed:!0})};render(){if(this.state.hasError){const{errorUrl:e}=this.props;return e&&!this.state.errorPageFailed?React.createElement(s,{errorUrl:e,onErrorPageFailed:this.handleErrorPageFailed}):React.createElement(l,{handleRetry:this.handleRetry,error:this.state.error})}return this.props.children}}const s=({errorUrl:e,onErrorPageFailed:o})=>{const[s,a]=t(null);return r((()=>{let t=!0;return n(e).then((e=>{t&&e?.default?a((()=>e.default)):t&&o()})).catch((()=>{t&&o()})),()=>{t=!1}}),[e]),s?React.createElement(s,null):null};let a="";const n=async e=>{a&&(e=a+e);const t=e.includes("?")?"&":"?",r=`${e}${t}_ts=${Date.now()}`,o=await fetch(r),s=await o.text();let n=s;if(/\.jsx$/i.test(e)){window.Babel||await new Promise(((e,t)=>{const r=document.createElement("script");r.src="https://unpkg.com/@babel/standalone/babel.min.js",r.onload=e,r.onerror=()=>t(new Error("Failed to load Babel")),document.head.appendChild(r)}));n=Babel.transform(s,{presets:["react"],sourceType:"module"}).code}const l=new Blob([n],{type:"text/javascript"}),i=URL.createObjectURL(l);try{return await import(i)}finally{URL.revokeObjectURL(i)}};window.loadModule=n;const l=({handleRetry:e,error:t})=>React.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",textAlign:"center"}},React.createElement("p",{style:{color:"#ef4444",marginBottom:"1rem"}},"Une erreur s'est produite lors du chargement."),React.createElement("button",{onClick:e,style:{padding:"0.5rem 1rem",backgroundColor:"var(--color-primary)",color:"white",borderRadius:"0.25rem",border:"none",cursor:"pointer"}},"Réessayer")),i=({url:e,props:t={},errorUrl:r,children:s})=>{if(!e)return null;const a=React.useMemo((()=>React.lazy((async()=>{const t=await n(e),r=t?.default;if(!r)throw new Error("Aucun export par défaut après chargement");return{default:r}}))),[e]);return React.createElement(o,{errorUrl:r},React.createElement(React.Suspense,{fallback:React.createElement("div",null,s)},React.createElement(a,t)))};function c({url:e,props:t={},errorUrl:r,children:o}){return React.createElement(i,{key:e,url:e,props:t,errorUrl:r},o)}class h extends HTMLElement{constructor(){super(),this._url=null,this._errorUrl=null,this._props={},this._children=null,this._root=null,this._observer=null,this._useShadow=!1,this._shadowRoot=null}connectedCallback(){this._children=this.innerHTML,this._useShadow=this.hasAttribute("shadow"),this._useShadow?(this._shadowRoot=this.attachShadow({mode:"open"}),this._root=ReactDOM.createRoot(this._shadowRoot)):this._root=ReactDOM.createRoot(this),this._collectProps();const e=this.getAttribute("url");this._errorUrl=this.getAttribute("error"),a=this.getAttribute("base-url")||"",e&&(this._url=e,this._render()),this._observer=new MutationObserver((e=>{for(const t of e)"attributes"===t.type&&this._handleAttributeChange(t.attributeName,t.oldValue)})),this._observer.observe(this,{attributes:!0,attributeOldValue:!0})}disconnectedCallback(){this._observer&&this._observer.disconnect(),this._root&&this._root.unmount()}_handleAttributeChange(e,t){const r=this.getAttribute(e);"url"===e?this._url=r:"error"===e?this._errorUrl=r:"base-url"===e?a=r||"":"shadow"!==e&&(this._props[e]=r),this._render()}_collectProps(){this._props={};for(const e of this.attributes)"url"!==e.name&&"error"!==e.name&&"base-url"!==e.name&&"shadow"!==e.name&&(this._props[e.name]=e.value)}setProps(e){this._props={...this._props,...e},this._render()}getProps(){return this._props}_render(){this._root&&this._url&&this._root.render(React.createElement(c,{url:this._url,props:this._props,errorUrl:this._errorUrl},React.createElement("div",{dangerouslySetInnerHTML:{__html:this._children}})))}}customElements.define("web-app",h);